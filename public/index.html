<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, viewport-fit=cover"
    />
    <meta name="theme-color" content="#2563eb" />
    <meta
      name="description"
      content="AI ê¸°ë°˜ ë¡œë˜ 6/45 ë²ˆí˜¸ ì¶”ì²œ ë° ë‹¹ì²¨ í™•ì¸ ì•±"
    />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" />
    <title>ë¡œë˜ 6/45 - AI ë²ˆí˜¸ ì¶”ì²œ</title>
    
    <!-- TWA ìµœì í™” ìŠ¤íƒ€ì¼ -->
    <style>
      :root {
        --safe-area-inset-top: env(safe-area-inset-top, 0px);
        --safe-area-inset-right: env(safe-area-inset-right, 0px);
        --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
        --safe-area-inset-left: env(safe-area-inset-left, 0px);
      }
      
      body {
        margin: 0;
        padding: 0;
        padding-right: var(--safe-area-inset-right);
        padding-bottom: var(--safe-area-inset-bottom);
        padding-left: var(--safe-area-inset-left);
        width: 100%;
        height: 100vh;
        overflow-x: hidden;
      }
      
      #root {
        width: 100%;
        height: 100%;
      }

      /* TWA ì „ë©´ ê´‘ê³  ìŠ¤íƒ€ì¼ */
      .interstitial-ad {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #06b6d4 100%);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        animation: fadeIn 0.3s ease-out;
      }

      .ad-container {
        background: white;
        border-radius: 20px;
        padding: 30px 24px;
        text-align: center;
        max-width: 350px;
        width: 90%;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        position: relative;
        overflow: hidden;
      }

      .ad-close-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(0, 0, 0, 0.1);
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        cursor: pointer;
        font-size: 18px;
        color: #666;
        display: none;
        transition: all 0.2s;
      }

      .ad-close-btn:hover {
        background: rgba(0, 0, 0, 0.2);
      }

      .countdown-circle {
        position: relative;
        width: 120px;
        height: 120px;
        margin: 0 auto 20px;
      }

      .countdown-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 28px;
        font-weight: bold;
        color: #3b82f6;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
      }
    </style>
  </head>

  <body>
    <noscript>ì´ ì•±ì„ ì‹¤í–‰í•˜ë ¤ë©´ JavaScriptë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤.</noscript>
    <div id="root"></div>

    <!-- TWA ì „ë©´ ê´‘ê³  HTML -->
    <div id="interstitial-ad" class="interstitial-ad">
      <div class="ad-container">
        <button id="ad-close-btn" class="ad-close-btn" onclick="closeTWAAd()">&times;</button>
        
        <!-- ê´‘ê³  ë¡œë”© ìƒíƒœ -->
        <div id="ad-loading">
          <div style="font-size: 64px; margin-bottom: 20px; animation: pulse 2s infinite;">ğŸ“º</div>
          <h3 style="color: #1f2937; margin: 0 0 8px 0; font-size: 20px;">ê´‘ê³  ì‹œì²­ ì¤‘</h3>
          <p style="color: #6b7280; margin: 0 0 24px 0; font-size: 14px; line-height: 1.5;">
            1ë“± AI ë¹…ë°ì´í„° ë¶„ì„ì„ ìœ„í•´<br>
            ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!
          </p>
          
          <!-- ì›í˜• í”„ë¡œê·¸ë ˆìŠ¤ -->
          <div class="countdown-circle">
            <svg width="120" height="120" style="transform: rotate(-90deg);">
              <circle
                cx="60"
                cy="60"
                r="50"
                fill="none"
                stroke="#e5e7eb"
                stroke-width="8"
              />
              <circle
                id="progress-circle"
                cx="60"
                cy="60"
                r="50"
                fill="none"
                stroke="#3b82f6"
                stroke-width="8"
                stroke-linecap="round"
                stroke-dasharray="314"
                stroke-dashoffset="314"
                style="transition: stroke-dashoffset 1s linear;"
              />
            </svg>
            <div id="countdown-text" class="countdown-text">30</div>
          </div>
          
          <p id="countdown-message" style="color: #9ca3af; font-size: 12px; margin: 0;">
            30ì´ˆ í›„ AI ë¶„ì„ì´ ì‹œì‘ë©ë‹ˆë‹¤
          </p>
        </div>

        <!-- ì‹¤ì œ AdSense ê´‘ê³  ì˜ì—­ -->
        <div id="adsense-area" style="display: none; margin: 20px 0;">
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-app-pub-1789035686079773"
               data-ad-slot="2283321824"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
        </div>
      </div>
    </div>

    <!-- Android WebView ìµœì í™” ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
      // TWA í™˜ê²½ ê°ì§€ ë° ì„¤ì •
      const isTWA = window.matchMedia('(display-mode: standalone)').matches || 
                    navigator.standalone === true ||
                    document.referrer.includes('android-app://');

      console.log('TWA í™˜ê²½ ê°ì§€:', isTWA);

      // ê¸€ë¡œë²Œ ê´‘ê³  ë³€ìˆ˜
      window.adSystem = {
        showing: false,
        completed: false,
        timer: null
      };
    </script>

    <!-- Google AdSense - ì‹¤ì œ ìŠ¹ì¸ëœ ê³„ì • -->
    <script async 
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-app-pub-1789035686079773"
            crossorigin="anonymous"></script>

    <!-- TWA ê´‘ê³  ì‹œìŠ¤í…œ -->
    <script>
      // TWA ì „ë©´ ê´‘ê³  í‘œì‹œ
      window.showTWAAd = function() {
        console.log('ğŸ¯ TWA ì „ë©´ ê´‘ê³  ì‹œì‘');
        
        if (window.adSystem.showing) {
          console.log('âš ï¸ ì´ë¯¸ ê´‘ê³ ê°€ í‘œì‹œ ì¤‘ì…ë‹ˆë‹¤');
          return Promise.reject(new Error('ê´‘ê³ ê°€ ì´ë¯¸ í‘œì‹œ ì¤‘ì…ë‹ˆë‹¤'));
        }

        return new Promise((resolve, reject) => {
          try {
            const adElement = document.getElementById('interstitial-ad');
            const closeBtn = document.getElementById('ad-close-btn');
            const countdownText = document.getElementById('countdown-text');
            const progressCircle = document.getElementById('progress-circle');
            const countdownMessage = document.getElementById('countdown-message');
            const adsenseArea = document.getElementById('adsense-area');
            
            // ê´‘ê³  í‘œì‹œ
            adElement.style.display = 'flex';
            closeBtn.style.display = 'none';
            window.adSystem.showing = true;
            window.adSystem.completed = false;
            
            // AdSense ê´‘ê³  ë¡œë“œ ì‹œë„
            try {
              adsenseArea.style.display = 'block';
              if (typeof adsbygoogle !== 'undefined') {
                (adsbygoogle = window.adsbygoogle || []).push({});
                console.log('âœ… AdSense ê´‘ê³  ë¡œë“œ ì‹œë„');
              }
            } catch (error) {
              console.warn('AdSense ê´‘ê³  ë¡œë“œ ì‹¤íŒ¨:', error);
            }
            
            // 30ì´ˆ ì¹´ìš´íŠ¸ë‹¤ìš´
            let countdown = 30;
            const totalCircumference = 314;
            
            window.adSystem.timer = setInterval(() => {
              countdown--;
              countdownText.textContent = countdown;
              
              // í”„ë¡œê·¸ë ˆìŠ¤ ì› ì—…ë°ì´íŠ¸
              const progress = (30 - countdown) / 30;
              const offset = totalCircumference * (1 - progress);
              progressCircle.style.strokeDashoffset = offset;
              
              if (countdown <= 0) {
                clearInterval(window.adSystem.timer);
                window.adSystem.completed = true;
                
                // ë‹«ê¸° ë²„íŠ¼ í™œì„±í™”
                closeBtn.style.display = 'block';
                countdownText.textContent = 'âœ“';
                countdownMessage.textContent = 'ê´‘ê³ ë¥¼ ë‹«ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤';
                countdownMessage.style.color = '#059669';
                
                console.log('âœ… TWA ê´‘ê³  ì‹œì²­ ì™„ë£Œ');
                
                // ê´‘ê³  ì™„ë£Œ ì´ë²¤íŠ¸ ë°œì†¡
                const completedEvent = new CustomEvent('twaAdCompleted', {
                  detail: { 
                    reward: 'completed',
                    timestamp: Date.now()
                  }
                });
                window.dispatchEvent(completedEvent);
                
                resolve({ success: true, reward: 'completed' });
              } else {
                countdownMessage.textContent = `${countdown}ì´ˆ í›„ AI ë¶„ì„ì´ ì‹œì‘ë©ë‹ˆë‹¤`;
              }
            }, 1000);
            
          } catch (error) {
            console.error('âŒ TWA ê´‘ê³  í‘œì‹œ ì‹¤íŒ¨:', error);
            reject(error);
          }
        });
      };

      // TWA ê´‘ê³  ë‹«ê¸°
      window.closeTWAAd = function() {
        console.log('ğŸ“º TWA ê´‘ê³  ë‹«ê¸°');
        
        const adElement = document.getElementById('interstitial-ad');
        adElement.style.display = 'none';
        
        if (window.adSystem.timer) {
          clearInterval(window.adSystem.timer);
          window.adSystem.timer = null;
        }
        
        // ìƒíƒœ ì´ˆê¸°í™”
        window.adSystem.showing = false;
        
        // ê´‘ê³  ë‹«ê¸° ì´ë²¤íŠ¸ ë°œì†¡
        const closedEvent = new CustomEvent('twaAdClosed', {
          detail: { 
            completed: window.adSystem.completed,
            timestamp: Date.now()
          }
        });
        window.dispatchEvent(closedEvent);
        
        // ì´ˆê¸°í™”
        const countdownText = document.getElementById('countdown-text');
        const progressCircle = document.getElementById('progress-circle');
        const countdownMessage = document.getElementById('countdown-message');
        
        countdownText.textContent = '30';
        progressCircle.style.strokeDashoffset = '314';
        countdownMessage.textContent = '30ì´ˆ í›„ AI ë¶„ì„ì´ ì‹œì‘ë©ë‹ˆë‹¤';
        countdownMessage.style.color = '#9ca3af';
      };

      // TWA ê´‘ê³  ì‹œìŠ¤í…œ ì´ˆê¸°í™”
      window.addEventListener('load', function() {
        console.log('ğŸš€ TWA ê´‘ê³  ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
        
        // Reactì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ê¸€ë¡œë²Œ í•¨ìˆ˜ ì œê³µ
        window.loadRewardedAd = function() {
          return Promise.resolve(true);
        };
        
        window.showRewardedAd = function() {
          return window.showTWAAd();
        };
        
        // ê´‘ê³  ì™„ë£Œ ì´ë²¤íŠ¸ë¥¼ ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ í˜¸í™˜
        window.addEventListener('twaAdCompleted', function(event) {
          const adRewardEvent = new CustomEvent('adRewardEarned', {
            detail: event.detail
          });
          window.dispatchEvent(adRewardEvent);
        });
        
        window.addEventListener('twaAdClosed', function(event) {
          if (event.detail.completed) {
            const adRewardEvent = new CustomEvent('adRewardEarned', {
              detail: { reward: 'completed' }
            });
            window.dispatchEvent(adRewardEvent);
          }
        });
      });
    </script>
  </body>
</html>
