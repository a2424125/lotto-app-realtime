<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, viewport-fit=cover"
    />
    <meta name="theme-color" content="#2563eb" />
    <meta
      name="description"
      content="AI 기반 로또 6/45 번호 추천 및 당첨 확인 앱"
    />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" />
    <title>로또 6/45 - AI 번호 추천</title>
    
    <!-- TWA 최적화 스타일 -->
    <style>
      :root {
        --safe-area-inset-top: env(safe-area-inset-top, 0px);
        --safe-area-inset-right: env(safe-area-inset-right, 0px);
        --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
        --safe-area-inset-left: env(safe-area-inset-left, 0px);
      }
      
      body {
        margin: 0;
        padding: 0;
        padding-right: var(--safe-area-inset-right);
        padding-bottom: var(--safe-area-inset-bottom);
        padding-left: var(--safe-area-inset-left);
        width: 100%;
        height: 100vh;
        overflow-x: hidden;
      }
      
      #root {
        width: 100%;
        height: 100%;
      }

      /* TWA 전면 광고 스타일 */
      .interstitial-ad {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #06b6d4 100%);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        animation: fadeIn 0.3s ease-out;
      }

      .ad-container {
        background: white;
        border-radius: 20px;
        padding: 30px 24px;
        text-align: center;
        max-width: 350px;
        width: 90%;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        position: relative;
        overflow: hidden;
      }

      .ad-close-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(0, 0, 0, 0.1);
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        cursor: pointer;
        font-size: 18px;
        color: #666;
        display: none;
        transition: all 0.2s;
      }

      .ad-close-btn:hover {
        background: rgba(0, 0, 0, 0.2);
      }

      .countdown-circle {
        position: relative;
        width: 120px;
        height: 120px;
        margin: 0 auto 20px;
      }

      .countdown-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 28px;
        font-weight: bold;
        color: #3b82f6;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
      }
    </style>
  </head>

  <body>
    <noscript>이 앱을 실행하려면 JavaScript를 활성화해야 합니다.</noscript>
    <div id="root"></div>

    <!-- TWA 전면 광고 HTML -->
    <div id="interstitial-ad" class="interstitial-ad">
      <div class="ad-container">
        <button id="ad-close-btn" class="ad-close-btn" onclick="closeTWAAd()">&times;</button>
        
        <!-- 광고 로딩 상태 -->
        <div id="ad-loading">
          <div style="font-size: 64px; margin-bottom: 20px; animation: pulse 2s infinite;">📺</div>
          <h3 style="color: #1f2937; margin: 0 0 8px 0; font-size: 20px;">광고 시청 중</h3>
          <p style="color: #6b7280; margin: 0 0 24px 0; font-size: 14px; line-height: 1.5;">
            1등 AI 빅데이터 분석을 위해<br>
            잠시만 기다려주세요!
          </p>
          
          <!-- 원형 프로그레스 -->
          <div class="countdown-circle">
            <svg width="120" height="120" style="transform: rotate(-90deg);">
              <circle
                cx="60"
                cy="60"
                r="50"
                fill="none"
                stroke="#e5e7eb"
                stroke-width="8"
              />
              <circle
                id="progress-circle"
                cx="60"
                cy="60"
                r="50"
                fill="none"
                stroke="#3b82f6"
                stroke-width="8"
                stroke-linecap="round"
                stroke-dasharray="314"
                stroke-dashoffset="314"
                style="transition: stroke-dashoffset 1s linear;"
              />
            </svg>
            <div id="countdown-text" class="countdown-text">30</div>
          </div>
          
          <p id="countdown-message" style="color: #9ca3af; font-size: 12px; margin: 0;">
            30초 후 AI 분석이 시작됩니다
          </p>
        </div>

        <!-- 실제 AdSense 광고 영역 -->
        <div id="adsense-area" style="display: none; margin: 20px 0;">
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-app-pub-1789035686079773"
               data-ad-slot="2283321824"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
        </div>
      </div>
    </div>

    <!-- Android WebView 최적화 스크립트 -->
    <script>
      // TWA 환경 감지 및 설정
      const isTWA = window.matchMedia('(display-mode: standalone)').matches || 
                    navigator.standalone === true ||
                    document.referrer.includes('android-app://');

      console.log('TWA 환경 감지:', isTWA);

      // 글로벌 광고 변수
      window.adSystem = {
        showing: false,
        completed: false,
        timer: null
      };
    </script>

    <!-- Google AdSense - 실제 승인된 계정 -->
    <script async 
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-app-pub-1789035686079773"
            crossorigin="anonymous"></script>

    <!-- TWA 광고 시스템 -->
    <script>
      // TWA 전면 광고 표시
      window.showTWAAd = function() {
        console.log('🎯 TWA 전면 광고 시작');
        
        if (window.adSystem.showing) {
          console.log('⚠️ 이미 광고가 표시 중입니다');
          return Promise.reject(new Error('광고가 이미 표시 중입니다'));
        }

        return new Promise((resolve, reject) => {
          try {
            const adElement = document.getElementById('interstitial-ad');
            const closeBtn = document.getElementById('ad-close-btn');
            const countdownText = document.getElementById('countdown-text');
            const progressCircle = document.getElementById('progress-circle');
            const countdownMessage = document.getElementById('countdown-message');
            const adsenseArea = document.getElementById('adsense-area');
            
            // 광고 표시
            adElement.style.display = 'flex';
            closeBtn.style.display = 'none';
            window.adSystem.showing = true;
            window.adSystem.completed = false;
            
            // AdSense 광고 로드 시도
            try {
              adsenseArea.style.display = 'block';
              if (typeof adsbygoogle !== 'undefined') {
                (adsbygoogle = window.adsbygoogle || []).push({});
                console.log('✅ AdSense 광고 로드 시도');
              }
            } catch (error) {
              console.warn('AdSense 광고 로드 실패:', error);
            }
            
            // 30초 카운트다운
            let countdown = 30;
            const totalCircumference = 314;
            
            window.adSystem.timer = setInterval(() => {
              countdown--;
              countdownText.textContent = countdown;
              
              // 프로그레스 원 업데이트
              const progress = (30 - countdown) / 30;
              const offset = totalCircumference * (1 - progress);
              progressCircle.style.strokeDashoffset = offset;
              
              if (countdown <= 0) {
                clearInterval(window.adSystem.timer);
                window.adSystem.completed = true;
                
                // 닫기 버튼 활성화
                closeBtn.style.display = 'block';
                countdownText.textContent = '✓';
                countdownMessage.textContent = '광고를 닫을 수 있습니다';
                countdownMessage.style.color = '#059669';
                
                console.log('✅ TWA 광고 시청 완료');
                
                // 광고 완료 이벤트 발송
                const completedEvent = new CustomEvent('twaAdCompleted', {
                  detail: { 
                    reward: 'completed',
                    timestamp: Date.now()
                  }
                });
                window.dispatchEvent(completedEvent);
                
                resolve({ success: true, reward: 'completed' });
              } else {
                countdownMessage.textContent = `${countdown}초 후 AI 분석이 시작됩니다`;
              }
            }, 1000);
            
          } catch (error) {
            console.error('❌ TWA 광고 표시 실패:', error);
            reject(error);
          }
        });
      };

      // TWA 광고 닫기
      window.closeTWAAd = function() {
        console.log('📺 TWA 광고 닫기');
        
        const adElement = document.getElementById('interstitial-ad');
        adElement.style.display = 'none';
        
        if (window.adSystem.timer) {
          clearInterval(window.adSystem.timer);
          window.adSystem.timer = null;
        }
        
        // 상태 초기화
        window.adSystem.showing = false;
        
        // 광고 닫기 이벤트 발송
        const closedEvent = new CustomEvent('twaAdClosed', {
          detail: { 
            completed: window.adSystem.completed,
            timestamp: Date.now()
          }
        });
        window.dispatchEvent(closedEvent);
        
        // 초기화
        const countdownText = document.getElementById('countdown-text');
        const progressCircle = document.getElementById('progress-circle');
        const countdownMessage = document.getElementById('countdown-message');
        
        countdownText.textContent = '30';
        progressCircle.style.strokeDashoffset = '314';
        countdownMessage.textContent = '30초 후 AI 분석이 시작됩니다';
        countdownMessage.style.color = '#9ca3af';
      };

      // TWA 광고 시스템 초기화
      window.addEventListener('load', function() {
        console.log('🚀 TWA 광고 시스템 초기화 완료');
        
        // React에서 사용할 수 있도록 글로벌 함수 제공
        window.loadRewardedAd = function() {
          return Promise.resolve(true);
        };
        
        window.showRewardedAd = function() {
          return window.showTWAAd();
        };
        
        // 광고 완료 이벤트를 기존 시스템과 호환
        window.addEventListener('twaAdCompleted', function(event) {
          const adRewardEvent = new CustomEvent('adRewardEarned', {
            detail: event.detail
          });
          window.dispatchEvent(adRewardEvent);
        });
        
        window.addEventListener('twaAdClosed', function(event) {
          if (event.detail.completed) {
            const adRewardEvent = new CustomEvent('adRewardEarned', {
              detail: { reward: 'completed' }
            });
            window.dispatchEvent(adRewardEvent);
          }
        });
      });
    </script>
  </body>
</html>
